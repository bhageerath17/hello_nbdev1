---

title: Data


keywords: fastai
sidebar: home_sidebar

summary: "This page takes through the steps of the queries used, data collected and saved. The data saved in these steps is used for the analysis and modeling. "
description: "This page takes through the steps of the queries used, data collected and saved. The data saved in these steps is used for the analysis and modeling. "
nb_path: "05_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Connection">Connection<a class="anchor-link" href="#Connection"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Filters">Filters<a class="anchor-link" href="#Filters"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>December 2021 data for Detroit metro and Meijer store is used for the analysis</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Month</span> <span class="o">=</span> <span class="s1">&#39;2021-12-01&#39;</span>
<span class="n">Metro</span> <span class="o">=</span> <span class="s1">&#39;Detroit&#39;</span>
<span class="n">Retailer</span> <span class="o">=</span> <span class="s1">&#39;Meijer&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Order-financials">Order financials<a class="anchor-link" href="#Order-financials"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query">Query<a class="anchor-link" href="#Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">order_financials_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT date_trunc(</span>
<span class="s2">    &#39;month&#39;, convert_timezone(&#39;US/Central&#39;, delivered_at_utc)</span>
<span class="s2">    )::date AS MONTH,</span>
<span class="s2">    M.NAME AS METRO,</span>
<span class="s2">    s.name AS RETAILER,</span>
<span class="s2">    SUM(GMV) AS GMV,</span>
<span class="s2">    COUNT(DISTINCT o.id) AS ORDER_VOLUME</span>
<span class="s2">FROM PRD_DATALAKEHOUSE.DATA_SCIENCE.ORDER_FINANCIALS o</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.METROS m ON m.id = o.metro_id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.STORES s ON s.id = o.store_id</span>
<span class="s2">WHERE o.status =&#39;delivered&#39;</span>
<span class="s2">  AND convert_timezone(</span>
<span class="s2">    &#39;UTC&#39;, &#39;US/Central&#39;, DELIVERED_AT_UTC::timestamp_ntz</span>
<span class="s2">    )::date BETWEEN &#39;2020-01-01&#39; AND &#39;2021-12-31&#39;</span>
<span class="s2">  AND o.order_type = &#39;Marketplace&#39;</span>
<span class="s2">GROUP BY MONTH,</span>
<span class="s2">         METRO,</span>
<span class="s2">         RETAILER;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-data">Save data<a class="anchor-link" href="#Save-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ls</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>00_data.ipynb                <span class="ansi-blue-fg">data</span>/
01_analysis.ipynb            index.ipynb
02_models.ipynb              <span class="ansi-blue-fg">models</span>/
03_feature_importance.ipynb  <span class="ansi-blue-fg">reports</span>/
04_validation.ipynb
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(45357, 5)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MONTH</th>
      <th>METRO</th>
      <th>RETAILER</th>
      <th>GMV</th>
      <th>ORDER_VOLUME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2021-12-01</td>
      <td>Detroit</td>
      <td>Target</td>
      <td>831536.49</td>
      <td>10846</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2021-12-01</td>
      <td>Fort Myers / Cape Coral</td>
      <td>Publix</td>
      <td>590075.68</td>
      <td>5067</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2021-01-01</td>
      <td>Austin</td>
      <td>Target</td>
      <td>311242.01</td>
      <td>4124</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2021-12-01</td>
      <td>Reading</td>
      <td>Target</td>
      <td>54143.47</td>
      <td>682</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2021-06-01</td>
      <td>The Triad</td>
      <td>Costco</td>
      <td>40810.46</td>
      <td>294</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Average-metrics">Average metrics<a class="anchor-link" href="#Average-metrics"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query">Query<a class="anchor-link" href="#Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">avg_metrics_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT PRODUCT_ID,</span>
<span class="s2">       PRODUCT_NAME,</span>
<span class="s2">       AVG(GMV) AS AVG_GMV, </span>
<span class="s2">       AVG(ORDER_LINE_COUNT) AS AVG_ORDERLINES,</span>
<span class="s2">       AVG(QTY_SOLD) AS AVG_QTY,</span>
<span class="s2">       AVG(COST_SUM) AS AVG_COST,</span>
<span class="s2">       AVG(PRICE_SUM) AS AVG_PRICE,</span>
<span class="s2">       AVG(ORD_CUST_COUNT) AS AVG_CUST_COUNT</span>
<span class="s2">FROM</span>
<span class="s2">  (SELECT convert_timezone(</span>
<span class="s2">    &#39;UTC&#39;, &#39;US/Central&#39;, o.DELIVERED_AT::timestamp_ntz</span>
<span class="s2">    )::date AS DEL_DATE,</span>
<span class="s2">          M.NAME AS METRO,</span>
<span class="s2">          s.name AS RETAILER,</span>
<span class="s2">          ol.actual_product_id AS PRODUCT_ID,</span>
<span class="s2">          p.NAME AS PRODUCT_NAME, </span>
<span class="s2">          SUM(saved_product_price * actual_qty) AS GMV,</span>
<span class="s2">          COUNT(DISTINCT o.id) AS ORDER_VOLUME,</span>
<span class="s2">          COUNT(DISTINCT ol.id) AS ORDER_LINE_COUNT,</span>
<span class="s2">          SUM(ol.actual_qty) AS QTY_SOLD,</span>
<span class="s2">          SUM(ol.saved_product_cost) AS COST_SUM,</span>
<span class="s2">          SUM(ol.saved_product_price) AS PRICE_SUM,</span>
<span class="s2">          COUNT(DISTINCT o.CUSTOMER_ID) AS ORD_CUST_COUNT</span>
<span class="s2">   FROM PRD_DATALAKEHOUSE.OG_VIEWS.ORDER_LINES ol</span>
<span class="s2">   INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.ORDERS o ON ol.order_id = o.id</span>
<span class="s2">   INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.METROS m ON m.id = o.metro_id</span>
<span class="s2">   INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.STORES s ON s.id = o.store_id</span>
<span class="s2">   INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.PRODUCTS p ON p.id = ol.actual_product_id</span>
<span class="s2">   WHERE o.status =&#39;delivered&#39;</span>
<span class="s2">     AND ACTUAL_PRODUCT_TYPE = &#39;Product&#39;</span>
<span class="s2">     AND is_external_platform_order = FALSE</span>
<span class="s2">     AND partner_id IS NULL</span>
<span class="s2">     AND convert_timezone(</span>
<span class="s2">       &#39;UTC&#39;, &#39;US/Central&#39;, DELIVERED_AT::timestamp_ntz</span>
<span class="s2">       )::date BETWEEN &#39;2021-12-01&#39; AND &#39;2021-12-31&#39;</span>
<span class="s2">     AND m.name = &#39;Detroit&#39;</span>
<span class="s2">     AND s.name = &#39;Meijer&#39;</span>
<span class="s2">   GROUP BY DEL_DATE,</span>
<span class="s2">            METRO,</span>
<span class="s2">            RETAILER,</span>
<span class="s2">            PRODUCT_ID,</span>
<span class="s2">            PRODUCT_NAME)</span>
<span class="s2">GROUP BY PRODUCT_ID,</span>
<span class="s2">         PRODUCT_NAME</span>
<span class="s2">ORDER BY PRODUCT_NAME;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-data">Save data<a class="anchor-link" href="#Save-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_avg_metrics</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_avg_metrics</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(49694, 8)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PRODUCT_ID</th>
      <th>PRODUCT_NAME</th>
      <th>AVG_GMV</th>
      <th>AVG_ORDERLINES</th>
      <th>AVG_QTY</th>
      <th>AVG_COST</th>
      <th>AVG_PRICE</th>
      <th>AVG_CUST_COUNT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10286076</td>
      <td>"\tNOBLETREE Reverence Espresso Whole Bean Cof...</td>
      <td>10.49</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>8.99</td>
      <td>10.49</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10433693</td>
      <td>" Handcrafted Ornament Set, 1"" RoundDecember ...</td>
      <td>7.59</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>6.99</td>
      <td>7.59</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10438190</td>
      <td>" Handcrafted Ornament Set, 1"" RoundDecember ...</td>
      <td>7.59</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>6.99</td>
      <td>7.59</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10511929</td>
      <td>" Handcrafted Ornament Set, 1"" RoundDecember ...</td>
      <td>12.18</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.59</td>
      <td>6.09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10548473</td>
      <td>" Handcrafted Ornament Set, 1.5"" RoundDecembe...</td>
      <td>12.99</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>11.99</td>
      <td>12.99</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Click-stream-metrics">Click stream metrics<a class="anchor-link" href="#Click-stream-metrics"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Metrics grouped by product_id, product_name</p>
<p>Q: The metrics are at Product Id and Product name level for the entire month ??</p>
<ul>
<li><code>avg_cart_add_daily</code> and <code>ADD_TO_ORDER_daily</code> are not actually daily measures. These metrics are for the entire month for each <code>product_id</code> and <code>product_name</code></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query">Query<a class="anchor-link" href="#Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clickstream_metrics_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT DISTINCT product_id,</span>
<span class="s2">                product_name,</span>
<span class="s2">                AVG(ATC_count) AS avg_cart_add_daily,</span>
<span class="s2">                AVG(ADD_TO_ORDER_COUNT) AS ADD_TO_ORDER_daily</span>
<span class="s2">FROM</span>
<span class="s2">  (SELECT DISTINCT event_stamp::date AS event_date,</span>
<span class="s2">          product_id,</span>
<span class="s2">          product_name, </span>
<span class="s2">          COUNT(DISTINCT(CASE </span>
<span class="s2">            WHEN event_type = &#39;product_added_to_cart&#39; </span>
<span class="s2">            THEN EVENT_ID END)) </span>
<span class="s2">          AS ATC_count,</span>
<span class="s2">          COUNT(DISTINCT(CASE </span>
<span class="s2">            WHEN event_type = &#39;product_added_to_order&#39; </span>
<span class="s2">            THEN EVENT_ID END)) </span>
<span class="s2">          AS ADD_TO_ORDER_COUNT</span>
<span class="s2">   FROM PRD_SEGMENT_EVENTS.MEMBER.SEARCH_BROWSE_CONVERSIONS</span>
<span class="s2">   WHERE metro = &#39;Detroit&#39;</span>
<span class="s2">     AND store = &#39;Meijer&#39;</span>
<span class="s2">     AND event_stamp::date BETWEEN &#39;2021-12-01&#39; AND &#39;2021-12-31&#39;</span>
<span class="s2">   GROUP BY event_date,</span>
<span class="s2">            product_id,</span>
<span class="s2">            product_name</span>
<span class="s2">   ORDER BY ATC_COUNT DESC)</span>
<span class="s2">GROUP BY product_id,</span>
<span class="s2">         product_name;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-data">Save data<a class="anchor-link" href="#Save-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_clickstream_metrics</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_clickstream_metrics</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(56916, 4)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PRODUCT_ID</th>
      <th>PRODUCT_NAME</th>
      <th>AVG_CART_ADD_DAILY</th>
      <th>ADD_TO_ORDER_DAILY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4251091</td>
      <td>Hudsonville Ice Cream Triple Peanut Butter Cup</td>
      <td>2.608696</td>
      <td>0.086957</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3967404</td>
      <td>Hebrew National Bun Length Beef Franks</td>
      <td>3.500000</td>
      <td>0.035714</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3972759</td>
      <td>Thai Kitchen Gluten Free Unsweetened Coconut C...</td>
      <td>1.647059</td>
      <td>0.176471</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4039320</td>
      <td>bubly Grapefruit Sparkling Water</td>
      <td>2.263158</td>
      <td>0.105263</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3985119</td>
      <td>Pillsbury Chocolate Chip Cookie Dough</td>
      <td>3.250000</td>
      <td>0.107143</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Growth-metrics">Growth metrics<a class="anchor-link" href="#Growth-metrics"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Metrics grouped by <code>DATE_MONTH</code>, product_id and product_name</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query">Query<a class="anchor-link" href="#Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">growth_metrics_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT month(</span>
<span class="s2">  convert_timezone(</span>
<span class="s2">    &#39;UTC&#39;, &#39;US/Central&#39;, DELIVERED_AT::timestamp_ntz)::date</span>
<span class="s2">    ) AS date_month,</span>
<span class="s2">    ol.actual_product_id AS PRODUCT_ID,</span>
<span class="s2">    p.NAME AS PRODUCT_NAME, SUM(saved_product_price * actual_qty) AS GMV, </span>
<span class="s2">    COUNT(DISTINCT ol.id) AS ORDER_LINE_COUNT,</span>
<span class="s2">    SUM(ol.actual_qty) AS QTY_SOLD,</span>
<span class="s2">    COUNT(DISTINCT o.CUSTOMER_ID) AS ORD_CUST_COUNT</span>
<span class="s2">FROM PRD_DATALAKEHOUSE.OG_VIEWS.ORDER_LINES ol</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.ORDERS o ON ol.order_id = o.id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.METROS m ON m.id = o.metro_id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.STORES s ON s.id = o.store_id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.PRODUCTS p ON p.id = ol.actual_product_id</span>
<span class="s2">WHERE o.status =&#39;delivered&#39;</span>
<span class="s2">  AND ACTUAL_PRODUCT_TYPE = &#39;Product&#39;</span>
<span class="s2">  AND is_external_platform_order = FALSE</span>
<span class="s2">  AND partner_id IS NULL</span>
<span class="s2">  AND convert_timezone(</span>
<span class="s2">    &#39;UTC&#39;, &#39;US/Central&#39;, DELIVERED_AT::timestamp_ntz</span>
<span class="s2">    )::date BETWEEN &#39;2021-01-01&#39; AND &#39;2021-12-31&#39;</span>
<span class="s2">  AND m.name = &#39;Detroit&#39;</span>
<span class="s2">  AND s.name = &#39;Meijer&#39;</span>
<span class="s2">GROUP BY DATE_MONTH,</span>
<span class="s2">         PRODUCT_ID,</span>
<span class="s2">         PRODUCT_NAME;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-data---raw">Save data - raw<a class="anchor-link" href="#Save-data---raw"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_growth_metrics</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_growth_metrics</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(596110, 7)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DATE_MONTH</th>
      <th>PRODUCT_ID</th>
      <th>PRODUCT_NAME</th>
      <th>GMV</th>
      <th>ORDER_LINE_COUNT</th>
      <th>QTY_SOLD</th>
      <th>ORD_CUST_COUNT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9</td>
      <td>4003519</td>
      <td>Mashed Cauliflower</td>
      <td>376.60</td>
      <td>53</td>
      <td>60.0</td>
      <td>45</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12</td>
      <td>3974692</td>
      <td>Q-Tips Cotton Swabs</td>
      <td>1271.99</td>
      <td>301</td>
      <td>311.0</td>
      <td>298</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10</td>
      <td>3982786</td>
      <td>Dijon Mustard</td>
      <td>214.21</td>
      <td>145</td>
      <td>149.0</td>
      <td>142</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12</td>
      <td>3987097</td>
      <td>Lemon Lime Soda Bottle</td>
      <td>62.14</td>
      <td>19</td>
      <td>26.0</td>
      <td>18</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9</td>
      <td>6219504</td>
      <td>Eggland's Best Grade A Extra Large Eggs, 1 Dozen</td>
      <td>530.95</td>
      <td>127</td>
      <td>155.0</td>
      <td>112</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Derive-growth-metrics">Derive growth metrics<a class="anchor-link" href="#Derive-growth-metrics"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Bringing growth metrics at product level.</p>
<p>The following metrics are added</p>
<ol>
<li><code>GMV_growth</code></li>
<li><code>Order_line_growth</code></li>
<li><code>Qty_sold_growth</code></li>
<li><code>Ord_Cust_growth</code></li>
</ol>
<p>For each metric, the values are sorted based on <code>DATE_MONTH</code> and then grouped by <code>PRODUCT_ID</code> and respecive column (<code>GMV</code>, <code>ORDER_LINE_COUNT</code> etc.). Then, growth is computed by percentage change from the previous period</p>
<p><em>Example</em></p>
<div class="highlight"><pre><span></span><span class="n">df_growth_metrics</span><span class="p">[</span><span class="s2">&quot;GMV_growth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_growth_metrics</span><span class="p">[[</span><span class="s2">&quot;DATE_MONTH&quot;</span><span class="p">,</span> <span class="s2">&quot;PRODUCT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;GMV&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;DATE_MONTH&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;PRODUCT_ID&quot;</span><span class="p">])[</span><span class="s2">&quot;GMV&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_growth_metrics</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_growth_metrics</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="n">df_growth_metrics</span><span class="p">[</span><span class="s1">&#39;DATE_MONTH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(596110, 11)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DATE_MONTH</th>
      <td>9</td>
      <td>12</td>
      <td>10</td>
      <td>12</td>
      <td>9</td>
    </tr>
    <tr>
      <th>PRODUCT_ID</th>
      <td>4003519</td>
      <td>3974692</td>
      <td>3982786</td>
      <td>3987097</td>
      <td>6219504</td>
    </tr>
    <tr>
      <th>PRODUCT_NAME</th>
      <td>Mashed Cauliflower</td>
      <td>Q-Tips Cotton Swabs</td>
      <td>Dijon Mustard</td>
      <td>Lemon Lime Soda Bottle</td>
      <td>Eggland's Best Grade A Extra Large Eggs, 1 Dozen</td>
    </tr>
    <tr>
      <th>GMV</th>
      <td>376.6</td>
      <td>1271.99</td>
      <td>214.21</td>
      <td>62.14</td>
      <td>530.95</td>
    </tr>
    <tr>
      <th>ORDER_LINE_COUNT</th>
      <td>53</td>
      <td>301</td>
      <td>145</td>
      <td>19</td>
      <td>127</td>
    </tr>
    <tr>
      <th>QTY_SOLD</th>
      <td>60.0</td>
      <td>311.0</td>
      <td>149.0</td>
      <td>26.0</td>
      <td>155.0</td>
    </tr>
    <tr>
      <th>ORD_CUST_COUNT</th>
      <td>45</td>
      <td>298</td>
      <td>142</td>
      <td>18</td>
      <td>112</td>
    </tr>
    <tr>
      <th>GMV_growth</th>
      <td>0.415896</td>
      <td>-0.022591</td>
      <td>-0.236056</td>
      <td>0.083333</td>
      <td>0.305187</td>
    </tr>
    <tr>
      <th>Order_line_growth</th>
      <td>0.394737</td>
      <td>0.003333</td>
      <td>-0.08805</td>
      <td>-0.136364</td>
      <td>0.27</td>
    </tr>
    <tr>
      <th>Qty_sold_growth</th>
      <td>0.428571</td>
      <td>0.0</td>
      <td>-0.06875</td>
      <td>0.083333</td>
      <td>0.291667</td>
    </tr>
    <tr>
      <th>Ord_Cust_growth</th>
      <td>0.285714</td>
      <td>0.006757</td>
      <td>-0.095541</td>
      <td>-0.142857</td>
      <td>0.302326</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1     51255
3     51128
4     50993
5     50901
6     49842
12    49694
2     49649
8     49388
7     49071
9     48204
11    48005
10    47980
Name: DATE_MONTH, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For each <code>product_id</code>, mean value of the metric is computed to bring the metrics at product level</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_growth_final</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_growth_final</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(91863, 10)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PRODUCT_ID</th>
      <td>3.859281e+06</td>
      <td>3.859288e+06</td>
      <td>3.859290e+06</td>
      <td>3.859692e+06</td>
      <td>3.860143e+06</td>
    </tr>
    <tr>
      <th>DATE_MONTH</th>
      <td>6.500000e+00</td>
      <td>6.000000e+00</td>
      <td>6.500000e+00</td>
      <td>9.600000e+00</td>
      <td>6.500000e+00</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_GMV</th>
      <td>7.603250e+01</td>
      <td>1.106036e+02</td>
      <td>9.066083e+01</td>
      <td>1.536200e+01</td>
      <td>3.542427e+03</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORDER_LINE</th>
      <td>1.433333e+01</td>
      <td>1.563636e+01</td>
      <td>3.216667e+01</td>
      <td>1.800000e+00</td>
      <td>9.395000e+02</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_QTY_SOLD</th>
      <td>1.508333e+01</td>
      <td>1.600000e+01</td>
      <td>3.641667e+01</td>
      <td>1.800000e+00</td>
      <td>1.066500e+03</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORD_CUST</th>
      <td>1.350000e+01</td>
      <td>1.445455e+01</td>
      <td>2.883333e+01</td>
      <td>1.800000e+00</td>
      <td>7.990833e+02</td>
    </tr>
    <tr>
      <th>GMV_GROWTH</th>
      <td>1.066986e-01</td>
      <td>3.153868e-02</td>
      <td>-5.790777e-02</td>
      <td>8.361096e-02</td>
      <td>6.902904e-03</td>
    </tr>
    <tr>
      <th>ORDER_LINE_GROWTH</th>
      <td>9.651241e-02</td>
      <td>6.759113e-02</td>
      <td>-1.056347e-01</td>
      <td>8.333333e-02</td>
      <td>6.407062e-03</td>
    </tr>
    <tr>
      <th>QTY_SOLD_GROWTH</th>
      <td>1.094146e-01</td>
      <td>3.018294e-02</td>
      <td>-6.561971e-02</td>
      <td>8.333333e-02</td>
      <td>4.861500e-03</td>
    </tr>
    <tr>
      <th>ORD_CUST_GROWTH</th>
      <td>6.450540e-02</td>
      <td>1.017764e-01</td>
      <td>-9.447413e-02</td>
      <td>8.333333e-02</td>
      <td>-2.362699e-03</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_growth_final</span><span class="p">[</span><span class="s1">&#39;PRODUCT_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3859281     1
7738826     1
7738911     1
7738889     1
7738881     1
           ..
4019606     1
4019605     1
4019546     1
4019545     1
10759751    1
Name: PRODUCT_ID, Length: 91863, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-data---Interim">Save data - Interim<a class="anchor-link" href="#Save-data---Interim"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The data loaded using the query is transformed to include additional columns. The original data along with the new columns in saved at the <code>nbs/data/interim</code> folder.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="First-added-to-the-cart">First added to the cart<a class="anchor-link" href="#First-added-to-the-cart"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Query">Query<a class="anchor-link" href="#Query"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">first_added_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">with cte as (</span>
<span class="s2">    select row_number() over (</span>
<span class="s2">        partition by user_id, session_id order by session_event_row_number</span>
<span class="s2">        ) as row_number,</span>
<span class="s2">        seg.event_date, seg.store_id, seg.metro_id, </span>
<span class="s2">        seg.product_id, seg.order_number, p.name, ol.requested_qty,</span>
<span class="s2">ol.saved_product_price from</span>
<span class="s2">og_views.order_lines ol</span>
<span class="s2">inner join </span>
<span class="s2">  (</span>
<span class="s2">  --keep the row that was added first for the same product product_id</span>
<span class="s2">  select </span>
<span class="s2">    event_type, user_id, session_id,</span>
<span class="s2">    min(session_event_row_number) as session_event_row_number,</span>
<span class="s2">    event_date, platform, store_id,</span>
<span class="s2">    metro_id, cart_id, product_id, order_number from </span>
<span class="s2">    (</span>
<span class="s2">    select car.*, som.order_number from </span>
<span class="s2">      (</span>
<span class="s2">      --remove duplicate rows</span>
<span class="s2">      select event_type, event_type_secondary, event_id, user_id, session_id, </span>
<span class="s2">      session_event_row_number, event_date, event_time, platform, store_id, </span>
<span class="s2">      metro_id, cart_id, product_id</span>
<span class="s2">      from segment.segment_cart_add_remove</span>
<span class="s2">      group by event_type, event_type_secondary, event_id, user_id, session_id, </span>
<span class="s2">      session_event_row_number, event_date, event_time, platform, store_id, </span>
<span class="s2">      metro_id, cart_id, product_id</span>
<span class="s2">      having event_date between &#39;2021-12-01&#39; and &#39;2021-12-31&#39;</span>
<span class="s2">      and event_type = &#39;CART ADD ITEM&#39;</span>
<span class="s2">      ) car</span>
<span class="s2">    inner join segment.segment_order_summary som</span>
<span class="s2">    on car.user_id = som.user_id and</span>
<span class="s2">    car.session_id = som.session_id</span>
<span class="s2">    )</span>
<span class="s2">  group by event_type, user_id, session_id, event_date, platform, store_id,</span>
<span class="s2">  metro_id, cart_id, product_id, order_number</span>
<span class="s2">  order by user_id, session_id, session_event_row_number</span>
<span class="s2">  ) seg</span>
<span class="s2">--inner join og_views.order_lines ol on</span>
<span class="s2">on ol.order_id = seg.order_number</span>
<span class="s2">and ol.requested_product_id= seg.product_id</span>
<span class="s2">left join og_views.products p</span>
<span class="s2">on p.id = ol.requested_product_id</span>
<span class="s2">where to_date(ol.created_at) between &#39;2021-12-01&#39; and &#39;2021-12-31&#39;</span>
<span class="s2">order by user_id, session_id, session_event_row_number)</span>


<span class="s2">SELECT  product_id, count(product_id)</span>
<span class="s2">FROM    cte</span>
<span class="s2">WHERE   row_number = 1</span>
<span class="s2">and     metro_id = 49</span>
<span class="s2">and     store_id = 10</span>
<span class="s2">group by 1</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Save-data">Save data<a class="anchor-link" href="#Save-data"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Convert <code>PRODUCT_ID</code> to integer type and set it as index to the <code>df_first_added</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_first_added</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_first_added</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(18133, 1)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FIRST_ADDED_COUNT</th>
    </tr>
    <tr>
      <th>PRODUCT_ID</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3961305</th>
      <td>8</td>
    </tr>
    <tr>
      <th>3986831</th>
      <td>20</td>
    </tr>
    <tr>
      <th>3965215</th>
      <td>46</td>
    </tr>
    <tr>
      <th>3968330</th>
      <td>3</td>
    </tr>
    <tr>
      <th>3866509</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are 18,000 products that have been added at least once as the first product to the order</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="KVI---key-value-indicators">KVI - key value indicators<a class="anchor-link" href="#KVI---key-value-indicators"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Query">Query<a class="anchor-link" href="#Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kvis_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT DISTINCT ol.actual_product_id AS PRODUCT_ID,</span>
<span class="s2">                p.NAME AS PRODUCT_NAME,</span>
<span class="s2">                sps.KVI</span>
<span class="s2">FROM PRD_DATALAKEHOUSE.OG_VIEWS.ORDER_LINES ol</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.ORDERS o ON ol.order_id = o.id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.METROS m ON m.id = o.metro_id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.STORES s ON s.id = o.store_id</span>
<span class="s2">INNER JOIN PRD_DATALAKEHOUSE.OG_VIEWS.PRODUCTS p ON p.id = ol.actual_product_id</span>
<span class="s2">LEFT JOIN PRD_DATALAKEHOUSE.OG_VIEWS.STORE_PRODUCT_SETTINGS sps ON sps.product_id = ol.actual_product_id</span>
<span class="s2">AND sps.store_id = o.store_id</span>
<span class="s2">AND sps.metro_id = o.metro_id</span>
<span class="s2">WHERE o.status =&#39;delivered&#39;</span>
<span class="s2">  AND ACTUAL_PRODUCT_TYPE = &#39;Product&#39;</span>
<span class="s2">  AND is_external_platform_order = FALSE</span>
<span class="s2">  AND partner_id IS NULL</span>
<span class="s2">  AND convert_timezone(&#39;UTC&#39;, &#39;US/Central&#39;, DELIVERED_AT::timestamp_ntz)::date BETWEEN &#39;2021-12-01&#39; AND &#39;2021-12-31&#39;</span>
<span class="s2">  AND m.name = &#39;Detroit&#39;</span>
<span class="s2">  AND s.name = &#39;Meijer&#39;;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-data">Save data<a class="anchor-link" href="#Save-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some of the KVI's available are</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_kvis</span><span class="o">.</span><span class="n">shape</span>
<span class="n">df_kvis</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(49788, 3)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PRODUCT_ID</th>
      <th>PRODUCT_NAME</th>
      <th>KVI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3986421</td>
      <td>Microwaveable Beef Stew</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5772734</td>
      <td>Alka-Seltzer Plus Maximum Strength Cold &amp; Flu ...</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3980192</td>
      <td>Sail Cooked Shrimp, Frozen</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4047775</td>
      <td>Conventional Oil 10W</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4300863</td>
      <td>Meijer Omega 3 Krill Oil</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_kvis</span><span class="p">[</span><span class="s1">&#39;KVI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">df_kvis</span><span class="p">[</span><span class="s1">&#39;KVI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>False    48131
True      1604
Name: KVI, dtype: int64</pre>
</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0322509299286217</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='There are 1604 KVI&#8217;s available which is 3.2% of the total number of products' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Combine-data">Combine data<a class="anchor-link" href="#Combine-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Combine the average metrics data, click stream metrics data and growth metrics data at product level</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span>
<span class="n">final_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(45206, 19)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PRODUCT_NAME_x</th>
      <th>AVG_GMV</th>
      <th>AVG_ORDERLINES</th>
      <th>AVG_QTY</th>
      <th>AVG_COST</th>
      <th>AVG_PRICE</th>
      <th>AVG_CUST_COUNT</th>
      <th>AVG_CART_ADD_DAILY</th>
      <th>ADD_TO_ORDER_DAILY</th>
      <th>DATE_MONTH</th>
      <th>AVG_MONTHLY_GMV</th>
      <th>AVG_MONTHLY_ORDER_LINE</th>
      <th>AVG_MONTHLY_QTY_SOLD</th>
      <th>AVG_MONTHLY_ORD_CUST</th>
      <th>GMV_GROWTH</th>
      <th>ORDER_LINE_GROWTH</th>
      <th>QTY_SOLD_GROWTH</th>
      <th>ORD_CUST_GROWTH</th>
      <th>FIRST_ADDED_COUNT</th>
    </tr>
    <tr>
      <th>PRODUCT_ID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10433693</th>
      <td>" Handcrafted Ornament Set, 1"" RoundDecember ...</td>
      <td>7.590000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>6.990000</td>
      <td>7.590000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>11.500000</td>
      <td>7.590000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4264419</th>
      <td>"I and love and you" Cat Can Variety Pack</td>
      <td>66.360000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>13.990000</td>
      <td>16.590000</td>
      <td>1.000000</td>
      <td>1.666667</td>
      <td>0.333333</td>
      <td>7.166667</td>
      <td>73.538333</td>
      <td>2.666667</td>
      <td>4.500000</td>
      <td>2.500000</td>
      <td>1.464564</td>
      <td>0.600000</td>
      <td>1.453333</td>
      <td>0.420000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8381569</th>
      <td>"JIFFY" Honey Corn Muffin Mix</td>
      <td>3.926471</td>
      <td>2.411765</td>
      <td>4.411765</td>
      <td>1.664118</td>
      <td>2.146471</td>
      <td>2.352941</td>
      <td>3.476190</td>
      <td>0.190476</td>
      <td>6.500000</td>
      <td>39.597500</td>
      <td>23.416667</td>
      <td>41.916667</td>
      <td>22.166667</td>
      <td>0.168529</td>
      <td>0.167238</td>
      <td>0.202161</td>
      <td>0.162516</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9820133</th>
      <td>"This RITZ Saut Black Honeycomb Solid Dual Ki...</td>
      <td>3.790000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>3.490000</td>
      <td>3.790000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>10.000000</td>
      <td>7.285000</td>
      <td>1.000000</td>
      <td>1.500000</td>
      <td>1.000000</td>
      <td>-0.648423</td>
      <td>0.000000</td>
      <td>-0.500000</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3945853</th>
      <td>#10 Security Boxed Envelopes</td>
      <td>2.934545</td>
      <td>1.090909</td>
      <td>1.090909</td>
      <td>2.716364</td>
      <td>2.934545</td>
      <td>1.090909</td>
      <td>1.166667</td>
      <td>0.083333</td>
      <td>6.500000</td>
      <td>21.520000</td>
      <td>7.750000</td>
      <td>8.000000</td>
      <td>7.750000</td>
      <td>0.479654</td>
      <td>0.458442</td>
      <td>0.479654</td>
      <td>0.458442</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Numeric-columns">Numeric columns<a class="anchor-link" href="#Numeric-columns"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>PRODUCT_NAME</code> cant be converted to numeric type. It is a categorical column. So it is not included in the scaling process</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">numerical_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">final_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">final_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">]]</span>
<span class="n">numerical_cols</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;AVG_GMV&#39;,
 &#39;AVG_ORDERLINES&#39;,
 &#39;AVG_QTY&#39;,
 &#39;AVG_COST&#39;,
 &#39;AVG_PRICE&#39;,
 &#39;AVG_CUST_COUNT&#39;,
 &#39;AVG_CART_ADD_DAILY&#39;,
 &#39;ADD_TO_ORDER_DAILY&#39;,
 &#39;DATE_MONTH&#39;,
 &#39;AVG_MONTHLY_GMV&#39;,
 &#39;AVG_MONTHLY_ORDER_LINE&#39;,
 &#39;AVG_MONTHLY_QTY_SOLD&#39;,
 &#39;AVG_MONTHLY_ORD_CUST&#39;,
 &#39;GMV_GROWTH&#39;,
 &#39;ORDER_LINE_GROWTH&#39;,
 &#39;QTY_SOLD_GROWTH&#39;,
 &#39;ORD_CUST_GROWTH&#39;,
 &#39;FIRST_ADDED_COUNT&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Scaling">Scaling<a class="anchor-link" href="#Scaling"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Scaling the data to bring the data to the same scale for all the columns</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Standard-scaling">Standard scaling<a class="anchor-link" href="#Standard-scaling"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Standard scaling uses the mean and standard deviation to scale the data. <code>DATE_MONTH</code> is also normalized. The variable varies linearly for each product. So this may not be a good way to scale this column</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Data before scaling</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_df</span><span class="o">.</span><span class="n">shape</span>
<span class="n">final_df</span><span class="p">[</span><span class="n">numerical_cols</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(45206, 19)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PRODUCT_ID</th>
      <th>10433693</th>
      <th>4264419</th>
      <th>8381569</th>
      <th>9820133</th>
      <th>3945853</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AVG_GMV</th>
      <td>7.59</td>
      <td>66.360000</td>
      <td>3.926471</td>
      <td>3.790000</td>
      <td>2.934545</td>
    </tr>
    <tr>
      <th>AVG_ORDERLINES</th>
      <td>1.00</td>
      <td>1.000000</td>
      <td>2.411765</td>
      <td>1.000000</td>
      <td>1.090909</td>
    </tr>
    <tr>
      <th>AVG_QTY</th>
      <td>1.00</td>
      <td>4.000000</td>
      <td>4.411765</td>
      <td>1.000000</td>
      <td>1.090909</td>
    </tr>
    <tr>
      <th>AVG_COST</th>
      <td>6.99</td>
      <td>13.990000</td>
      <td>1.664118</td>
      <td>3.490000</td>
      <td>2.716364</td>
    </tr>
    <tr>
      <th>AVG_PRICE</th>
      <td>7.59</td>
      <td>16.590000</td>
      <td>2.146471</td>
      <td>3.790000</td>
      <td>2.934545</td>
    </tr>
    <tr>
      <th>AVG_CUST_COUNT</th>
      <td>1.00</td>
      <td>1.000000</td>
      <td>2.352941</td>
      <td>1.000000</td>
      <td>1.090909</td>
    </tr>
    <tr>
      <th>AVG_CART_ADD_DAILY</th>
      <td>1.00</td>
      <td>1.666667</td>
      <td>3.476190</td>
      <td>1.000000</td>
      <td>1.166667</td>
    </tr>
    <tr>
      <th>ADD_TO_ORDER_DAILY</th>
      <td>0.00</td>
      <td>0.333333</td>
      <td>0.190476</td>
      <td>0.000000</td>
      <td>0.083333</td>
    </tr>
    <tr>
      <th>DATE_MONTH</th>
      <td>11.50</td>
      <td>7.166667</td>
      <td>6.500000</td>
      <td>10.000000</td>
      <td>6.500000</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_GMV</th>
      <td>7.59</td>
      <td>73.538333</td>
      <td>39.597500</td>
      <td>7.285000</td>
      <td>21.520000</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORDER_LINE</th>
      <td>1.00</td>
      <td>2.666667</td>
      <td>23.416667</td>
      <td>1.000000</td>
      <td>7.750000</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_QTY_SOLD</th>
      <td>1.00</td>
      <td>4.500000</td>
      <td>41.916667</td>
      <td>1.500000</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORD_CUST</th>
      <td>1.00</td>
      <td>2.500000</td>
      <td>22.166667</td>
      <td>1.000000</td>
      <td>7.750000</td>
    </tr>
    <tr>
      <th>GMV_GROWTH</th>
      <td>0.00</td>
      <td>1.464564</td>
      <td>0.168529</td>
      <td>-0.648423</td>
      <td>0.479654</td>
    </tr>
    <tr>
      <th>ORDER_LINE_GROWTH</th>
      <td>0.00</td>
      <td>0.600000</td>
      <td>0.167238</td>
      <td>0.000000</td>
      <td>0.458442</td>
    </tr>
    <tr>
      <th>QTY_SOLD_GROWTH</th>
      <td>0.00</td>
      <td>1.453333</td>
      <td>0.202161</td>
      <td>-0.500000</td>
      <td>0.479654</td>
    </tr>
    <tr>
      <th>ORD_CUST_GROWTH</th>
      <td>0.00</td>
      <td>0.420000</td>
      <td>0.162516</td>
      <td>0.000000</td>
      <td>0.458442</td>
    </tr>
    <tr>
      <th>FIRST_ADDED_COUNT</th>
      <td>0.00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Data after scaling</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_df_std_scaling</span><span class="o">.</span><span class="n">shape</span>
<span class="n">final_df_std_scaling</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(45206, 18)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>PRODUCT_ID</th>
      <th>10433693</th>
      <th>4264419</th>
      <th>8381569</th>
      <th>9820133</th>
      <th>3945853</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AVG_GMV</th>
      <td>-0.268471</td>
      <td>1.820673</td>
      <td>-0.398701</td>
      <td>-0.403553</td>
      <td>-0.433962</td>
    </tr>
    <tr>
      <th>AVG_ORDERLINES</th>
      <td>-0.160189</td>
      <td>-0.160189</td>
      <td>0.048793</td>
      <td>-0.160189</td>
      <td>-0.146732</td>
    </tr>
    <tr>
      <th>AVG_QTY</th>
      <td>-0.092161</td>
      <td>0.059573</td>
      <td>0.080400</td>
      <td>-0.092161</td>
      <td>-0.087563</td>
    </tr>
    <tr>
      <th>AVG_COST</th>
      <td>-0.212606</td>
      <td>0.153996</td>
      <td>-0.491531</td>
      <td>-0.395907</td>
      <td>-0.436423</td>
    </tr>
    <tr>
      <th>AVG_PRICE</th>
      <td>-0.241144</td>
      <td>0.177262</td>
      <td>-0.494210</td>
      <td>-0.417804</td>
      <td>-0.457573</td>
    </tr>
    <tr>
      <th>AVG_CUST_COUNT</th>
      <td>-0.158776</td>
      <td>-0.158776</td>
      <td>0.042060</td>
      <td>-0.158776</td>
      <td>-0.145281</td>
    </tr>
    <tr>
      <th>AVG_CART_ADD_DAILY</th>
      <td>-0.102077</td>
      <td>-0.064090</td>
      <td>0.039020</td>
      <td>-0.102077</td>
      <td>-0.092580</td>
    </tr>
    <tr>
      <th>ADD_TO_ORDER_DAILY</th>
      <td>-0.298786</td>
      <td>0.522763</td>
      <td>0.170670</td>
      <td>-0.298786</td>
      <td>-0.093399</td>
    </tr>
    <tr>
      <th>DATE_MONTH</th>
      <td>3.338651</td>
      <td>0.080649</td>
      <td>-0.420582</td>
      <td>2.210881</td>
      <td>-0.420582</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_GMV</th>
      <td>-0.245118</td>
      <td>-0.163668</td>
      <td>-0.205587</td>
      <td>-0.245495</td>
      <td>-0.227914</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORDER_LINE</th>
      <td>-0.172591</td>
      <td>-0.165122</td>
      <td>-0.072134</td>
      <td>-0.172591</td>
      <td>-0.142342</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_QTY_SOLD</th>
      <td>-0.082724</td>
      <td>-0.077471</td>
      <td>-0.021315</td>
      <td>-0.081974</td>
      <td>-0.072218</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORD_CUST</th>
      <td>-0.208169</td>
      <td>-0.198505</td>
      <td>-0.071803</td>
      <td>-0.208169</td>
      <td>-0.164682</td>
    </tr>
    <tr>
      <th>GMV_GROWTH</th>
      <td>-0.322859</td>
      <td>0.811057</td>
      <td>-0.192378</td>
      <td>-0.824891</td>
      <td>0.048505</td>
    </tr>
    <tr>
      <th>ORDER_LINE_GROWTH</th>
      <td>-0.305431</td>
      <td>0.229072</td>
      <td>-0.156449</td>
      <td>-0.305431</td>
      <td>0.102966</td>
    </tr>
    <tr>
      <th>QTY_SOLD_GROWTH</th>
      <td>-0.305521</td>
      <td>0.776639</td>
      <td>-0.154990</td>
      <td>-0.677824</td>
      <td>0.051632</td>
    </tr>
    <tr>
      <th>ORD_CUST_GROWTH</th>
      <td>-0.305271</td>
      <td>0.088995</td>
      <td>-0.152713</td>
      <td>-0.305271</td>
      <td>0.125082</td>
    </tr>
    <tr>
      <th>FIRST_ADDED_COUNT</th>
      <td>-0.140379</td>
      <td>-0.140379</td>
      <td>-0.140379</td>
      <td>-0.140379</td>
      <td>-0.140379</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Robust-scaling">Robust scaling<a class="anchor-link" href="#Robust-scaling"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Robust scaling uses the median and IQR to scale the data. The scaling is more robust to outliers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After scaling the data using robust scaling</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_df_robust_scaling</span><span class="o">.</span><span class="n">shape</span>
<span class="n">final_df_robust_scaling</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(45206, 18)</pre>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AVG_GMV</th>
      <td>-0.028948</td>
      <td>0.895536</td>
      <td>-0.086578</td>
      <td>-0.088724</td>
      <td>-0.102181</td>
    </tr>
    <tr>
      <th>AVG_ORDERLINES</th>
      <td>-0.016240</td>
      <td>-0.016240</td>
      <td>0.144249</td>
      <td>-0.016240</td>
      <td>-0.005905</td>
    </tr>
    <tr>
      <th>AVG_QTY</th>
      <td>-0.033512</td>
      <td>0.207775</td>
      <td>0.240893</td>
      <td>-0.033512</td>
      <td>-0.026200</td>
    </tr>
    <tr>
      <th>AVG_COST</th>
      <td>0.000861</td>
      <td>0.144362</td>
      <td>-0.108321</td>
      <td>-0.070890</td>
      <td>-0.086749</td>
    </tr>
    <tr>
      <th>AVG_PRICE</th>
      <td>-0.008932</td>
      <td>0.151849</td>
      <td>-0.106179</td>
      <td>-0.076818</td>
      <td>-0.092100</td>
    </tr>
    <tr>
      <th>AVG_CUST_COUNT</th>
      <td>-0.014313</td>
      <td>-0.014313</td>
      <td>0.140604</td>
      <td>-0.014313</td>
      <td>-0.003904</td>
    </tr>
    <tr>
      <th>AVG_CART_ADD_DAILY</th>
      <td>-0.026436</td>
      <td>0.022030</td>
      <td>0.153578</td>
      <td>-0.026436</td>
      <td>-0.014319</td>
    </tr>
    <tr>
      <th>ADD_TO_ORDER_DAILY</th>
      <td>0.000000</td>
      <td>0.333333</td>
      <td>0.190476</td>
      <td>0.000000</td>
      <td>0.083333</td>
    </tr>
    <tr>
      <th>DATE_MONTH</th>
      <td>0.862069</td>
      <td>0.114943</td>
      <td>0.000000</td>
      <td>0.603448</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_GMV</th>
      <td>-0.031231</td>
      <td>0.013180</td>
      <td>-0.009676</td>
      <td>-0.031436</td>
      <td>-0.021850</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORDER_LINE</th>
      <td>-0.021640</td>
      <td>-0.015945</td>
      <td>0.054954</td>
      <td>-0.021640</td>
      <td>0.001424</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_QTY_SOLD</th>
      <td>-0.020135</td>
      <td>-0.011326</td>
      <td>0.082846</td>
      <td>-0.018876</td>
      <td>-0.002517</td>
    </tr>
    <tr>
      <th>AVG_MONTHLY_ORD_CUST</th>
      <td>-0.022810</td>
      <td>-0.016836</td>
      <td>0.061491</td>
      <td>-0.022810</td>
      <td>0.004073</td>
    </tr>
    <tr>
      <th>GMV_GROWTH</th>
      <td>-0.064544</td>
      <td>0.474477</td>
      <td>-0.002518</td>
      <td>-0.303191</td>
      <td>0.111989</td>
    </tr>
    <tr>
      <th>ORDER_LINE_GROWTH</th>
      <td>-0.063437</td>
      <td>0.205025</td>
      <td>0.011391</td>
      <td>-0.063437</td>
      <td>0.141687</td>
    </tr>
    <tr>
      <th>QTY_SOLD_GROWTH</th>
      <td>-0.060241</td>
      <td>0.465060</td>
      <td>0.012829</td>
      <td>-0.240964</td>
      <td>0.113128</td>
    </tr>
    <tr>
      <th>ORD_CUST_GROWTH</th>
      <td>-0.062823</td>
      <td>0.133245</td>
      <td>0.013044</td>
      <td>-0.062823</td>
      <td>0.151190</td>
    </tr>
    <tr>
      <th>FIRST_ADDED_COUNT</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-data">Save data<a class="anchor-link" href="#Save-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Save the data to nbs/data folder</p>

</div>
</div>
</div>
</div>
 

